<!DOCTYPE html>
<html>
<head>
    <title>DNS Manager</title>
    <style>
        body { font-family: system-ui; background: #f5f5f5; }
        .container { max-width: 1000px; margin: auto; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; border-bottom: 1px solid #ddd; }
        button { padding: 6px 12px; }
        .hidden { display: none; }
        .error { color: red; }
    </style>
</head>
<body>

<div class="container">

    <div class="box">
        <h1>DNS Records</h1>
        <table>
            <thead>
                <tr>
                    <th>Name</th><th>Type</th><th>Value</th><th>TTL</th><th></th>
                </tr>
            </thead>
            <tbody id="records"></tbody>
        </table>
    </div>

    <div id="admin" class="box hidden">
        <h2>Add Record</h2>
        <input id="name" placeholder="example.com." />
        <select id="type">
            <option>A</option>
            <option>AAAA</option>
            <option>CNAME</option>
            <option>MX</option>
            <option>TXT</option>
            <option>NS</option>
            <option>PTR</option>
        </select>
        <input id="value" placeholder="value" />
        <input id="ttl" type="number" value="3600" />
        <button onclick="add()">Add</button>
        <button onclick="logout()">Logout</button>
    </div>

    <div id="login" class="box">
        <h2>Admin Login</h2>
        <input id="password" type="password" placeholder="password" />
        <button onclick="login()">Login</button>
        <div id="msg" class="error"></div>
    </div>

</div>

<script>
async function load() {
    const res = await fetch("/admin/records");
    const data = await res.json();
    const tbody = document.getElementById("records");
    tbody.innerHTML = "";

    data.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${r.Name}</td>
            <td>${typeToStr(r.Type)}</td>
            <td>${r.Value}</td>
            <td>${r.TTL}</td>
            <td><button onclick="del('${r.Name}',${r.Type},'${r.Value}')">Delete</button></td>
        `;
        tbody.appendChild(tr);
    });
}

async function login() {
    const password = document.getElementById("password").value;
    const res = await fetch("/login", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({password}),
        credentials: "same-origin"
    });

    if (res.ok) {
        document.getElementById("admin").classList.remove("hidden");
        document.getElementById("login").classList.add("hidden");
    } else {
        document.getElementById("msg").textContent = "Login failed";
    }
}

async function logout() {
    await fetch("/logout", { method: "POST", credentials: "same-origin" });
    location.reload();
}

async function add() {
    const nameEl = document.getElementById("name");
    const typeEl = document.getElementById("type");
    const valueEl = document.getElementById("value");
    const ttlEl = document.getElementById("ttl");

    await fetch("/admin/records", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        credentials: "same-origin",
        body: JSON.stringify({
            name: nameEl.value,
            type: strToType(typeEl.value),
            value: valueEl.value,
            ttl: parseInt(ttlEl.value, 10)
        })
    });
    load();
}

async function del(name, type, value) {
    await fetch("/admin/records", {
        method: "DELETE",
        headers: {"Content-Type":"application/json"},
        credentials: "same-origin",
        body: JSON.stringify({ name, type, value })
    });
    load();
}

const map = {1:"A",28:"AAAA",5:"CNAME",15:"MX",16:"TXT",2:"NS",12:"PTR"};
const rev = Object.fromEntries(Object.entries(map).map(([k,v])=>[v,parseInt(k)]));
const typeToStr = t => map[t] || "";
const strToType = s => rev[s] || 0;

load();
</script>

</body>
</html>
