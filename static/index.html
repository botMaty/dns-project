<!DOCTYPE html>
<html>
<head>
    <title>DNS Manager</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .header h1 { font-size: 24px; color: #333; }
        .form-group { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 100px; gap: 10px; margin-bottom: 15px; }
        .form-row input, .form-row select { padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .btn-delete { background: #dc3545; padding: 6px 12px; font-size: 12px; }
        .btn-delete:hover { background: #c82333; }
        .records { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 12px; text-align: left; font-weight: 600; border-bottom: 1px solid #ddd; }
        td { padding: 12px; border-bottom: 1px solid #ddd; }
        tr:hover { background: #f8f9fa; }
        .error { color: #dc3545; padding: 10px; background: #f8d7da; border-radius: 4px; margin-bottom: 10px; }
        .success { color: #155724; padding: 10px; background: #d4edda; border-radius: 4px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ”§ DNS Manager</h1>
        </div>

        <div id="message"></div>

        <div class="form-group">
            <h2>Add Record</h2>
            <div class="form-row">
                <input id="name" type="text" placeholder="Domain (e.g., example.com.)" />
                <select id="type">
                    <option value="A">A</option>
                    <option value="AAAA">AAAA</option>
                    <option value="CNAME">CNAME</option>
                    <option value="MX">MX</option>
                    <option value="TXT">TXT</option>
                    <option value="NS">NS</option>
                    <option value="PTR">PTR</option>
                </select>
                <input id="value" type="text" placeholder="Value (e.g., 192.168.1.1)" />
                <input id="ttl" type="number" placeholder="TTL" value="3600" />
                <button onclick="addRecord()">Add</button>
            </div>
        </div>

        <div class="records">
            <table>
                <thead>
                    <tr>
                        <th>Domain</th>
                        <th>Type</th>
                        <th>Value</th>
                        <th>TTL</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="recordsList"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = "/admin/records";
        const TOKEN = "super-secret-token";

        async function loadRecords() {
            try {
                const res = await fetch(API_URL, {
                    headers: { "Authorization": "Bearer " + TOKEN }
                });
                const records = await res.json() || [];
                const tbody = document.getElementById("recordsList");
                tbody.innerHTML = "";
                
                records.forEach(r => {
                    const tr = document.createElement("tr");
                    
                    // Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
                    const tdName = document.createElement("td");
                    tdName.textContent = r.Name;
                    
                    const tdType = document.createElement("td");
                    tdType.textContent = recordTypeToString(r.Type);
                    
                    const tdValue = document.createElement("td");
                    tdValue.textContent = r.Value;
                    
                    const tdTTL = document.createElement("td");
                    tdTTL.textContent = r.TTL;
                    
                    // Ø¯Ú©Ù…Ù‡ delete
                    const tdAction = document.createElement("td");
                    const deleteBtn = document.createElement("button");
                    deleteBtn.className = "btn-delete";
                    deleteBtn.textContent = "Delete";
                    deleteBtn.onclick = () => {
                        deleteRecord(r.Name, recordTypeToString(r.Type), r.Value);
                    };
                    tdAction.appendChild(deleteBtn);
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø±Ø¯ÛŒÙ
                    tr.appendChild(tdName);
                    tr.appendChild(tdType);
                    tr.appendChild(tdValue);
                    tr.appendChild(tdTTL);
                    tr.appendChild(tdAction);
                    
                    tbody.appendChild(tr);
                });
            } catch (e) {
                showError("Failed to load records");
            }
        }

        async function addRecord() {
            const name = document.getElementById("name").value;
            const type = stringToRecordType(document.getElementById("type").value);
            const value = document.getElementById("value").value;
            const ttl = parseInt(document.getElementById("ttl").value);

            if (!name || !value) {
                showError("Please fill all fields");
                return;
            }

            try {
                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Authorization": "Bearer " + TOKEN,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ name, type, value, ttl })
                });

                if (res.ok) {
                    showSuccess("Record added!");
                    document.getElementById("name").value = "";
                    document.getElementById("value").value = "";
                    loadRecords();
                } else {
                    showError("Failed to add record");
                }
            } catch (e) {
                showError("Error: " + e.message);
            }
        }

        async function deleteRecord(name, strType, value) {
            if (!confirm("Delete this record?")) return;
            const type = stringToRecordType(strType);

            try {
                const res = await fetch(API_URL, {
                    method: "DELETE",
                    headers: {
                        "Authorization": "Bearer " + TOKEN,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ name, type, value })
                });

                if (res.ok) {
                    showSuccess("Record deleted!");
                    loadRecords();
                } else {
                    showError("Failed to delete record");
                }
            } catch (e) {
                showError("Error: " + e.message);
            }
        }

        const recordTypes = {
            numberToString: {
                1: "A",
                28: "AAAA", 
                5: "CNAME",
                15: "MX",
                2: "NS",
                16: "TXT",
                12: "PTR"
            },
            
            stringToNumber: {}
        };

        Object.entries(recordTypes.numberToString).forEach(([num, name]) => {
            recordTypes.stringToNumber[name] = parseInt(num);
        });

        // ØªÙˆØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„
        function recordTypeToString(rt) {
            return recordTypes.numberToString[rt] || "";
        }

        function stringToRecordType(s) {
            return recordTypes.stringToNumber[s] || 0;
        }

        function showError(msg) {
            const div = document.getElementById("message");
            div.className = "error";
            div.textContent = msg;
            setTimeout(() => div.textContent = "", 5000);
        }

        function showSuccess(msg) {
            const div = document.getElementById("message");
            div.className = "success";
            div.textContent = msg;
            setTimeout(() => div.textContent = "", 3000);
        }

        loadRecords();
        setInterval(loadRecords, 5000);
    </script>
</body>
</html>